This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where empty lines have been removed, content has been compressed (code blocks are separated by ⋮---- delimiter), security check has been disabled.

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Empty lines have been removed from all files
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Security check has been disabled - content may contain sensitive information
- Files are sorted by Git change count (files with more changes are at the bottom)

# Directory Structure
```
.changeset/
  config.json
  README.md
.cursor/
  rules/
    ultracite.mdc
.github/
  ISSUE_TEMPLATE/
    bug_report.yml
    config.yml
    feature_request.yml
  workflows/
    actions/
      verify-changesets/
        index.js
        package.json
        test.js
    release.yml
    test.yml
    verify-changesets.yml
  pull_request_template.md
  SECURITY.md
apps/
  test/
    app/
      api/
        chat/
          route.ts
      globals.css
      layout.tsx
      page.tsx
    lib/
      utils.ts
    .gitignore
    components.json
    next.config.ts
    package.json
    postcss.config.mjs
    tsconfig.json
  website/
    .cursor/
      rules/
        ultracite.mdc
    .vscode/
      settings.json
    app/
      components/
        code-blocks.tsx
        cta.tsx
        faq.tsx
        footer.tsx
        gfm.tsx
        hardened.tsx
        header.tsx
        hero.tsx
        implementation.tsx
        installer.tsx
        mathematics.tsx
        mermaid.tsx
        props.tsx
        section.tsx
        styles.tsx
        terminator-parser.tsx
      globals.css
      layout.tsx
      page.tsx
    components/
      ui/
        accordion.tsx
        button.tsx
        tabs.tsx
      code-block.tsx
      mode-toggle.tsx
      providers.tsx
    lib/
      utils.ts
    public/
      file.svg
      globe.svg
      next.svg
      vercel.svg
      window.svg
    .gitignore
    components.json
    next.config.ts
    package.json
    postcss.config.mjs
    README.md
    tsconfig.json
packages/
  streamdown/
    __tests__/
      code-block.test.tsx
      components.test.tsx
      dollar-sign.test.tsx
      latex-begin-issue.test.tsx
      matrix-equation.test.tsx
      mermaid.test.tsx
      parse-incomplete-markdown.test.ts
      setup.ts
      streamdown.test.tsx
      utils.test.ts
    lib/
      code-block.tsx
      components.tsx
      mermaid.tsx
      parse-blocks.tsx
      parse-incomplete-markdown.ts
      utils.ts
    CHANGELOG.md
    index.tsx
    package.json
    README.md
    tsconfig.json
    tsup.config.ts
    vitest.config.ts
.gitattributes
.gitignore
biome.jsonc
CODE_OF_CONDUCT.md
CONTRIBUTING.md
LICENSE
package.json
pnpm-workspace.yaml
README.md
tsconfig.json
turbo.json
vercel.json
```

# Files

## File: .changeset/config.json
`````json
{
  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": ["website", "test"]
}
`````

## File: .changeset/README.md
`````markdown
# Changesets

Hello and welcome! This folder has been automatically generated by `@changesets/cli`, a build tool that works
with multi-package repos, or single-package repos to help you version and publish your code. You can
find the full documentation for it [in our repository](https://github.com/changesets/changesets)

We have a quick list of common questions to get you started engaging with this project in
[our documentation](https://github.com/changesets/changesets/blob/main/docs/common-questions.md)
`````

## File: .cursor/rules/ultracite.mdc
`````
---
description: Ultracite Rules - AI-Ready Formatter and Linter
globs: "**/*.{ts,tsx,js,jsx}"
alwaysApply: true
---

# Project Context
Ultracite enforces strict type safety, accessibility standards, and consistent code quality for JavaScript/TypeScript projects using Biome's lightning-fast formatter and linter.

## Key Principles
- Zero configuration required
- Subsecond performance
- Maximum type safety
- AI-friendly code generation

## Before Writing Code
1. Analyze existing patterns in the codebase
2. Consider edge cases and error scenarios
3. Follow the rules below strictly
4. Validate accessibility requirements

## Rules

### Accessibility (a11y)
- Don't use `accessKey` attribute on any HTML element.
- Don't set `aria-hidden="true"` on focusable elements.
- Don't add ARIA roles, states, and properties to elements that don't support them.
- Don't use distracting elements like `<marquee>` or `<blink>`.
- Only use the `scope` prop on `<th>` elements.
- Don't assign non-interactive ARIA roles to interactive HTML elements.
- Make sure label elements have text content and are associated with an input.
- Don't assign interactive ARIA roles to non-interactive HTML elements.
- Don't assign `tabIndex` to non-interactive HTML elements.
- Don't use positive integers for `tabIndex` property.
- Don't include "image", "picture", or "photo" in img alt prop.
- Don't use explicit role property that's the same as the implicit/default role.
- Make static elements with click handlers use a valid role attribute.
- Always include a `title` element for SVG elements.
- Give all elements requiring alt text meaningful information for screen readers.
- Make sure anchors have content that's accessible to screen readers.
- Assign `tabIndex` to non-interactive HTML elements with `aria-activedescendant`.
- Include all required ARIA attributes for elements with ARIA roles.
- Make sure ARIA properties are valid for the element's supported roles.
- Always include a `type` attribute for button elements.
- Make elements with interactive roles and handlers focusable.
- Give heading elements content that's accessible to screen readers (not hidden with `aria-hidden`).
- Always include a `lang` attribute on the html element.
- Always include a `title` attribute for iframe elements.
- Accompany `onClick` with at least one of: `onKeyUp`, `onKeyDown`, or `onKeyPress`.
- Accompany `onMouseOver`/`onMouseOut` with `onFocus`/`onBlur`.
- Include caption tracks for audio and video elements.
- Use semantic elements instead of role attributes in JSX.
- Make sure all anchors are valid and navigable.
- Ensure all ARIA properties (`aria-*`) are valid.
- Use valid, non-abstract ARIA roles for elements with ARIA roles.
- Use valid ARIA state and property values.
- Use valid values for the `autocomplete` attribute on input elements.
- Use correct ISO language/country codes for the `lang` attribute.

### Code Complexity and Quality
- Don't use consecutive spaces in regular expression literals.
- Don't use the `arguments` object.
- Don't use primitive type aliases or misleading types.
- Don't use the comma operator.
- Don't use empty type parameters in type aliases and interfaces.
- Don't write functions that exceed a given Cognitive Complexity score.
- Don't nest describe() blocks too deeply in test files.
- Don't use unnecessary boolean casts.
- Don't use unnecessary callbacks with flatMap.
- Use for...of statements instead of Array.forEach.
- Don't create classes that only have static members (like a static namespace).
- Don't use this and super in static contexts.
- Don't use unnecessary catch clauses.
- Don't use unnecessary constructors.
- Don't use unnecessary continue statements.
- Don't export empty modules that don't change anything.
- Don't use unnecessary escape sequences in regular expression literals.
- Don't use unnecessary fragments.
- Don't use unnecessary labels.
- Don't use unnecessary nested block statements.
- Don't rename imports, exports, and destructured assignments to the same name.
- Don't use unnecessary string or template literal concatenation.
- Don't use String.raw in template literals when there are no escape sequences.
- Don't use useless case statements in switch statements.
- Don't use ternary operators when simpler alternatives exist.
- Don't use useless `this` aliasing.
- Don't use any or unknown as type constraints.
- Don't initialize variables to undefined.
- Don't use the void operators (they're not familiar).
- Use arrow functions instead of function expressions.
- Use Date.now() to get milliseconds since the Unix Epoch.
- Use .flatMap() instead of map().flat() when possible.
- Use literal property access instead of computed property access.
- Don't use parseInt() or Number.parseInt() when binary, octal, or hexadecimal literals work.
- Use concise optional chaining instead of chained logical expressions.
- Use regular expression literals instead of the RegExp constructor when possible.
- Don't use number literal object member names that aren't base 10 or use underscore separators.
- Remove redundant terms from logical expressions.
- Use while loops instead of for loops when you don't need initializer and update expressions.
- Don't pass children as props.
- Don't reassign const variables.
- Don't use constant expressions in conditions.
- Don't use `Math.min` and `Math.max` to clamp values when the result is constant.
- Don't return a value from a constructor.
- Don't use empty character classes in regular expression literals.
- Don't use empty destructuring patterns.
- Don't call global object properties as functions.
- Don't declare functions and vars that are accessible outside their block.
- Make sure builtins are correctly instantiated.
- Don't use super() incorrectly inside classes. Also check that super() is called in classes that extend other constructors.
- Don't use variables and function parameters before they're declared.
- Don't use 8 and 9 escape sequences in string literals.
- Don't use literal numbers that lose precision.

### React and JSX Best Practices
- Don't use the return value of React.render.
- Make sure all dependencies are correctly specified in React hooks.
- Make sure all React hooks are called from the top level of component functions.
- Don't forget key props in iterators and collection literals.
- Don't destructure props inside JSX components in Solid projects.
- Don't define React components inside other components.
- Don't use event handlers on non-interactive elements.
- Don't assign to React component props.
- Don't use both `children` and `dangerouslySetInnerHTML` props on the same element.
- Don't use dangerous JSX props.
- Don't use Array index in keys.
- Don't insert comments as text nodes.
- Don't assign JSX properties multiple times.
- Don't add extra closing tags for components without children.
- Use `<>...</>` instead of `<Fragment>...</Fragment>`.
- Watch out for possible "wrong" semicolons inside JSX elements.

### Correctness and Safety
- Don't assign a value to itself.
- Don't return a value from a setter.
- Don't compare expressions that modify string case with non-compliant values.
- Don't use lexical declarations in switch clauses.
- Don't use variables that haven't been declared in the document.
- Don't write unreachable code.
- Make sure super() is called exactly once on every code path in a class constructor before this is accessed if the class has a superclass.
- Don't use control flow statements in finally blocks.
- Don't use optional chaining where undefined values aren't allowed.
- Don't have unused function parameters.
- Don't have unused imports.
- Don't have unused labels.
- Don't have unused private class members.
- Don't have unused variables.
- Make sure void (self-closing) elements don't have children.
- Don't return a value from a function with the return type 'void'
- Use isNaN() when checking for NaN.
- Make sure "for" loop update clauses move the counter in the right direction.
- Make sure typeof expressions are compared to valid values.
- Make sure generator functions contain yield.
- Don't use await inside loops.
- Don't use bitwise operators.
- Don't use expressions where the operation doesn't change the value.
- Make sure Promise-like statements are handled appropriately.
- Don't use __dirname and __filename in the global scope.
- Prevent import cycles.
- Don't use configured elements.
- Don't hardcode sensitive data like API keys and tokens.
- Don't let variable declarations shadow variables from outer scopes.
- Don't use the TypeScript directive @ts-ignore.
- Prevent duplicate polyfills from Polyfill.io.
- Don't use useless backreferences in regular expressions that always match empty strings.
- Don't use unnecessary escapes in string literals.
- Don't use useless undefined.
- Make sure getters and setters for the same property are next to each other in class and object definitions.
- Make sure object literals are declared consistently (defaults to explicit definitions).
- Use static Response methods instead of new Response() constructor when possible.
- Make sure switch-case statements are exhaustive.
- Make sure the `preconnect` attribute is used when using Google Fonts.
- Use `Array#{indexOf,lastIndexOf}()` instead of `Array#{findIndex,findLastIndex}()` when looking for the index of an item.
- Make sure iterable callbacks return consistent values.
- Use `with { type: "json" }` for JSON module imports.
- Use numeric separators in numeric literals.
- Use object spread instead of `Object.assign()` when constructing new objects.
- Always use the radix argument when using `parseInt()`.
- Make sure JSDoc comment lines start with a single asterisk, except for the first one.
- Include a description parameter for `Symbol()`.
- Don't use spread (`...`) syntax on accumulators.
- Don't use the `delete` operator.
- Don't access namespace imports dynamically.
- Don't use namespace imports.
- Declare regex literals at the top level.
- Don't use `target="_blank"` without `rel="noopener"`.

### TypeScript Best Practices
- Don't use TypeScript enums.
- Don't export imported variables.
- Don't add type annotations to variables, parameters, and class properties that are initialized with literal expressions.
- Don't use TypeScript namespaces.
- Don't use non-null assertions with the `!` postfix operator.
- Don't use parameter properties in class constructors.
- Don't use user-defined types.
- Use `as const` instead of literal types and type annotations.
- Use either `T[]` or `Array<T>` consistently.
- Initialize each enum member value explicitly.
- Use `export type` for types.
- Use `import type` for types.
- Make sure all enum members are literal values.
- Don't use TypeScript const enum.
- Don't declare empty interfaces.
- Don't let variables evolve into any type through reassignments.
- Don't use the any type.
- Don't misuse the non-null assertion operator (!) in TypeScript files.
- Don't use implicit any type on variable declarations.
- Don't merge interfaces and classes unsafely.
- Don't use overload signatures that aren't next to each other.
- Use the namespace keyword instead of the module keyword to declare TypeScript namespaces.

### Style and Consistency
- Don't use global `eval()`.
- Don't use callbacks in asynchronous tests and hooks.
- Don't use negation in `if` statements that have `else` clauses.
- Don't use nested ternary expressions.
- Don't reassign function parameters.
- This rule lets you specify global variable names you don't want to use in your application.
- Don't use specified modules when loaded by import or require.
- Don't use constants whose value is the upper-case version of their name.
- Use `String.slice()` instead of `String.substr()` and `String.substring()`.
- Don't use template literals if you don't need interpolation or special-character handling.
- Don't use `else` blocks when the `if` block breaks early.
- Don't use yoda expressions.
- Don't use Array constructors.
- Use `at()` instead of integer index access.
- Follow curly brace conventions.
- Use `else if` instead of nested `if` statements in `else` clauses.
- Use single `if` statements instead of nested `if` clauses.
- Use `new` for all builtins except `String`, `Number`, and `Boolean`.
- Use consistent accessibility modifiers on class properties and methods.
- Use `const` declarations for variables that are only assigned once.
- Put default function parameters and optional function parameters last.
- Include a `default` clause in switch statements.
- Use the `**` operator instead of `Math.pow`.
- Use `for-of` loops when you need the index to extract an item from the iterated array.
- Use `node:assert/strict` over `node:assert`.
- Use the `node:` protocol for Node.js builtin modules.
- Use Number properties instead of global ones.
- Use assignment operator shorthand where possible.
- Use function types instead of object types with call signatures.
- Use template literals over string concatenation.
- Use `new` when throwing an error.
- Don't throw non-Error values.
- Use `String.trimStart()` and `String.trimEnd()` over `String.trimLeft()` and `String.trimRight()`.
- Use standard constants instead of approximated literals.
- Don't assign values in expressions.
- Don't use async functions as Promise executors.
- Don't reassign exceptions in catch clauses.
- Don't reassign class members.
- Don't compare against -0.
- Don't use labeled statements that aren't loops.
- Don't use void type outside of generic or return types.
- Don't use console.
- Don't use control characters and escape sequences that match control characters in regular expression literals.
- Don't use debugger.
- Don't assign directly to document.cookie.
- Use `===` and `!==`.
- Don't use duplicate case labels.
- Don't use duplicate class members.
- Don't use duplicate conditions in if-else-if chains.
- Don't use two keys with the same name inside objects.
- Don't use duplicate function parameter names.
- Don't have duplicate hooks in describe blocks.
- Don't use empty block statements and static blocks.
- Don't let switch clauses fall through.
- Don't reassign function declarations.
- Don't allow assignments to native objects and read-only global variables.
- Use Number.isFinite instead of global isFinite.
- Use Number.isNaN instead of global isNaN.
- Don't assign to imported bindings.
- Don't use irregular whitespace characters.
- Don't use labels that share a name with a variable.
- Don't use characters made with multiple code points in character class syntax.
- Make sure to use new and constructor properly.
- Don't use shorthand assign when the variable appears on both sides.
- Don't use octal escape sequences in string literals.
- Don't use Object.prototype builtins directly.
- Don't redeclare variables, functions, classes, and types in the same scope.
- Don't have redundant "use strict".
- Don't compare things where both sides are exactly the same.
- Don't let identifiers shadow restricted names.
- Don't use sparse arrays (arrays with holes).
- Don't use template literal placeholder syntax in regular strings.
- Don't use the then property.
- Don't use unsafe negation.
- Don't use var.
- Don't use with statements in non-strict contexts.
- Make sure async functions actually use await.
- Make sure default clauses in switch statements come last.
- Make sure to pass a message value when creating a built-in error.
- Make sure get methods always return a value.
- Use a recommended display strategy with Google Fonts.
- Make sure for-in loops include an if statement.
- Use Array.isArray() instead of instanceof Array.
- Make sure to use the digits argument with Number#toFixed().
- Make sure to use the "use strict" directive in script files.

### Next.js Specific Rules
- Don't use `<img>` elements in Next.js projects.
- Don't use `<head>` elements in Next.js projects.
- Don't import next/document outside of pages/_document.jsx in Next.js projects.
- Don't use the next/head module in pages/_document.js on Next.js projects.

### Testing Best Practices
- Don't use export or module.exports in test files.
- Don't use focused tests.
- Make sure the assertion function, like expect, is placed inside an it() function call.
- Don't use disabled tests.

## Common Tasks
- `npx ultracite init` - Initialize Ultracite in your project
- `npx ultracite format` - Format and fix code automatically
- `npx ultracite lint` - Check for issues without fixing

## Example: Error Handling
```typescript
// ✅ Good: Comprehensive error handling
try {
  const result = await fetchData();
  return { success: true, data: result };
} catch (error) {
  console.error('API call failed:', error);
  return { success: false, error: error.message };
}

// ❌ Bad: Swallowing errors
try {
  return await fetchData();
} catch (e) {
  console.log(e);
}
```
`````

## File: .github/ISSUE_TEMPLATE/bug_report.yml
`````yaml
name: Bug Report
description: Report a bug or unexpected behavior in Streamdown
title: "I want to report a bug..."
labels: ["bug", "needs-triage"]
body:
  - type: markdown
    attributes:
      value: |
        Thanks for taking the time to report this bug! Please fill out the information below to help us understand and fix the issue.
  - type: textarea
    id: description
    attributes:
      label: Bug Description
      description: A clear and concise description of what the bug is.
      placeholder: Describe the bug...
    validations:
      required: true
  - type: textarea
    id: reproduction
    attributes:
      label: Steps to Reproduce
      description: Steps to reproduce the behavior
      placeholder: |
        1. Import Streamdown with '...'
        2. Pass markdown content '...'
        3. Render component with '...'
        4. See error
    validations:
      required: true
  - type: textarea
    id: expected
    attributes:
      label: Expected Behavior
      description: What you expected to happen
      placeholder: Describe what should happen...
    validations:
      required: true
  - type: textarea
    id: actual
    attributes:
      label: Actual Behavior
      description: What actually happened
      placeholder: Describe what actually happened...
    validations:
      required: true
  - type: textarea
    id: code-sample
    attributes:
      label: Code Sample
      description: If applicable, add a minimal code sample to help reproduce the issue
      render: tsx
      placeholder: |
        import { Streamdown } from 'streamdown';
        // Your code here...
  - type: input
    id: version
    attributes:
      label: Streamdown Version
      description: What version of Streamdown are you using?
      placeholder: e.g., 1.1.1
    validations:
      required: true
  - type: input
    id: react-version
    attributes:
      label: React Version
      description: What version of React are you using?
      placeholder: e.g., 18.2.0 or 19.0.0
    validations:
      required: true
  - type: input
    id: node-version
    attributes:
      label: Node.js Version
      description: What version of Node.js are you using?
      placeholder: e.g., 20.10.0
  - type: dropdown
    id: browsers
    attributes:
      label: Browser(s)
      description: What browsers are you seeing the problem on?
      multiple: true
      options:
        - Chrome
        - Firefox
        - Safari
        - Edge
        - Other
        - Not applicable (Node.js)
  - type: dropdown
    id: os
    attributes:
      label: Operating System
      options:
        - macOS
        - Windows
        - Linux
        - iOS
        - Android
        - Other
  - type: textarea
    id: additional
    attributes:
      label: Additional Context
      description: Add any other context about the problem here (e.g., screenshots, error messages, console logs)
      placeholder: Any additional information...
`````

## File: .github/ISSUE_TEMPLATE/config.yml
`````yaml
blank_issues_enabled: false
contact_links:
  - name: Documentation
    url: https://streamdown.ai
    about: Check out the documentation for usage examples and API reference
  - name: GitHub Discussions
    url: https://github.com/vercel/streamdown/discussions
    about: Ask questions and discuss ideas with the community
  - name: Security Vulnerability
    url: https://github.com/vercel/streamdown/security/advisories/new
    about: Please report security vulnerabilities privately
`````

## File: .github/ISSUE_TEMPLATE/feature_request.yml
`````yaml
name: Feature Request
description: Suggest a new feature or enhancement for Streamdown
title: "I have an idea for a feature..."
labels: ["enhancement", "needs-triage"]
body:
  - type: markdown
    attributes:
      value: |
        Thanks for suggesting a feature! Please provide as much detail as possible to help us understand your request.
  - type: textarea
    id: problem
    attributes:
      label: Problem Statement
      description: Is your feature request related to a problem? Please describe.
      placeholder: I'm always frustrated when...
    validations:
      required: true
  - type: textarea
    id: solution
    attributes:
      label: Proposed Solution
      description: Describe the solution you'd like
      placeholder: I would like Streamdown to...
    validations:
      required: true
  - type: textarea
    id: alternatives
    attributes:
      label: Alternatives Considered
      description: Describe any alternative solutions or features you've considered
      placeholder: I've also considered...
  - type: textarea
    id: use-case
    attributes:
      label: Use Case
      description: Provide a code example or use case showing how this feature would be used
      render: tsx
      placeholder: |
        import { Streamdown } from 'streamdown';
        // Example of how the feature would work...
  - type: dropdown
    id: priority
    attributes:
      label: Priority
      description: How important is this feature to you?
      options:
        - Nice to have
        - Important
        - Critical
  - type: checkboxes
    id: contribution
    attributes:
      label: Contribution
      options:
        - label: I am willing to help implement this feature
          required: false
  - type: textarea
    id: additional
    attributes:
      label: Additional Context
      description: Add any other context, mockups, or examples about the feature request
      placeholder: Any additional information...
`````

## File: .github/workflows/actions/verify-changesets/index.js
`````javascript
// check if current file is the entry point
if (import.meta.url.endsWith(process.argv[1])) {
// https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request
const pullRequestEvent = JSON.parse(
await fs.readFile(process.env.GITHUB_EVENT_PATH, 'utf-8'),
⋮----
const message = await verifyChangesets(
⋮----
await fs.writeFile(
⋮----
// write error to summary
console.error(error.message);
⋮----
await fs.appendFile(
⋮----
process.exit(1);
⋮----
export async function verifyChangesets(
⋮----
// Skip check if pull request has "minor-release" label
const byPassLabel = event.pull_request.labels.find(label =>
BYPASS_LABELS.includes(label.name),
⋮----
// Iterate through all changed .changeset/*.md files
for (const path of env.CHANGED_FILES.trim().split(' ')) {
// ignore README.md file
⋮----
// Check if the file is a .changeset file
if (!/^\.changeset\/[a-z-]+\.md/.test(path)) {
throw Object.assign(new Error(`Invalid file - not a .changeset file`), {
⋮----
// find frontmatter
const content = await readFile(`../../../../${path}`, 'utf-8');
const result = content.match(/---\n([\s\S]+?)\n---/);
⋮----
throw Object.assign(
new Error(`Invalid .changeset file - no frontmatter found`),
⋮----
// Find version bump by package. `frontmatter` looks like this:
//
// ```yaml
// 'ai': patch
// '@ai-sdk/provider': patch
// ```
const lines = frontmatter.split('\n').slice(1, -1);
⋮----
const [packageName, versionBump] = line.split(':').map(s => s.trim());
⋮----
new Error(`Invalid .changeset file - invalid frontmatter`, {
⋮----
// Check if packageName is already set
⋮----
new Error(
⋮----
// check if any of the version bumps are not "patch"
const invalidVersionBumps = Object.entries(versionBumps).filter(
⋮----
`Invalid .changeset file - invalid version bump (only "patch" is allowed, see https://ai-sdk.dev/docs/migration-guides/versioning). To bypass, add one of the following labels: ${BYPASS_LABELS.join(', ')}`,
`````

## File: .github/workflows/actions/verify-changesets/package.json
`````json
{
  "name": "verify-changesets-action",
  "private": true,
  "type": "module",
  "scripts": {
    "test": "node --test test.js"
  }
}
`````

## File: .github/workflows/actions/verify-changesets/test.js
`````javascript
test('happy path', async () => {
⋮----
const readFile = mock.fn(async path => {
⋮----
await verifyChangesets(event, env, readFile);
assert.strictEqual(readFile.mock.callCount(), 1);
assert.deepStrictEqual(readFile.mock.calls[0].arguments, [
⋮----
test('ignores .changeset/README.md', async () => {
⋮----
const readFile = mock.fn(() => {});
⋮----
assert.strictEqual(readFile.mock.callCount(), 0);
⋮----
test('invalid file - not a .changeset file', async () => {
⋮----
await assert.rejects(
() => verifyChangesets(event, env, readFile),
Object.assign(new Error('Invalid file - not a .changeset file'), {
⋮----
test('invalid .changeset file - no frontmatter', async () => {
⋮----
Object.assign(new Error('Invalid .changeset file - no frontmatter found'), {
⋮----
test('minor update', async () => {
⋮----
if (path.endsWith('patch-update.md')) {
⋮----
Object.assign(
new Error(
⋮----
assert.strictEqual(readFile.mock.callCount(), 2);
⋮----
assert.deepStrictEqual(readFile.mock.calls[1].arguments, [
⋮----
test('minor update - with "minor" label', async () => {
⋮----
const message = await verifyChangesets(event, env, readFile);
assert.strictEqual(
⋮----
test('major update - with "major" label', async () => {
`````

## File: .github/workflows/release.yml
`````yaml
name: Release
on:
  push:
    branches:
      - main
concurrency: ${{ github.workflow }}-${{ github.ref }}
permissions:
  contents: write
  pull-requests: write
  id-token: write
jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Generate GitHub App Token
        id: generate-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.STREAMDOWN_APP_ID }}
          private-key: ${{ secrets.STREAMDOWN_APP_PRIVATE_KEY }}
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          token: ${{ steps.generate-token.outputs.token }}
      - name: Setup Git User
        run: |
          git config --global user.email "streamdown-bot[bot]@users.noreply.github.com"
          git config --global user.name "streamdown-bot[bot]"
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      - name: Setup Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: 22
          registry-url: 'https://registry.npmjs.org'
      - name: Install Dependencies
        run: pnpm i
      - name: Build Packages
        run: pnpm build --filter streamdown
      - name: Run Tests
        run: pnpm test
      - name: Create Release Pull Request or Publish to npm
        id: changesets
        uses: changesets/action@v1
        with:
          version: pnpm changeset version
          publish: pnpm changeset publish
          createGithubReleases: true
          setupGitUser: false
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
      - name: Deploy to Vercel
        if: steps.changesets.outputs.published == 'true'
        run: npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}
        env:
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
`````

## File: .github/workflows/test.yml
`````yaml
name: Test
on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      - name: Setup Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: 22
      - name: Install Dependencies
        run: pnpm i
      - name: Run Tests
        run: pnpm test
`````

## File: .github/workflows/verify-changesets.yml
`````yaml
# vercel/ai uses https://github.com/changesets/changesets for versioning and changelogs,
# but is not following semantic versioning. Instead, it uses `patch` for both fixes
# and features. It uses `minor` for "marketing releases", accompanied by a blog post and migration guide.
# This workflow verifies that all `.changeset/*.md` files use `patch` unless a `minor-release` label is present.
name: Verify Changesets
on:
  pull_request:
    types: [opened, synchronize, reopened, labeled, unlabeled]
    branches:
      - main
    paths:
      - '.changeset/*.md'
permissions:
  contents: read
  pull-requests: read
jobs:
  verify-changesets:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Generate GitHub App Token
        id: generate-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.STREAMDOWN_APP_ID }}
          private-key: ${{ secrets.STREAMDOWN_APP_PRIVATE_KEY }}
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ steps.generate-token.outputs.token }}
      - uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
      - name: get all changed files from .changeset/*.md
        id: changeset-files
        run: |
          echo "changed-files=$(git diff --diff-filter=dr --name-only $BASE_SHA -- '.changeset/*.md' | tr '\n' ' ')" >> $GITHUB_OUTPUT
        env:
          BASE_SHA: ${{ github.event.pull_request.base.sha }}
      - name: Verify changesets
        if: steps.changeset-files.outputs.changed-files != ''
        working-directory: .github/workflows/actions/verify-changesets
        run: |
          node index.js
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}
          CHANGED_FILES: ${{ steps.changeset-files.outputs.changed-files }}
`````

## File: .github/pull_request_template.md
`````markdown
## Description

<!-- Provide a brief description of the changes in this PR -->

## Type of Change

<!-- Mark the relevant option with an "x" -->

- [ ] Bug fix (non-breaking change which fixes an issue)
- [ ] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update
- [ ] Performance improvement
- [ ] Refactoring (no functional changes)

## Related Issues

<!-- Link any related issues using #issue-number -->

Fixes #
Closes #
Related to #

## Changes Made

<!-- List the specific changes made in this PR -->

- 
- 
- 

## Testing

<!-- Describe the tests you ran to verify your changes -->

- [ ] All existing tests pass
- [ ] Added new tests for the changes
- [ ] Manually tested the changes

### Test Coverage

<!-- If applicable, include test coverage information -->

## Screenshots/Demos

<!-- If applicable, add screenshots or demos to help explain your changes -->

## Checklist

<!-- Mark completed items with an "x" -->

- [ ] My code follows the project's code style
- [ ] I have performed a self-review of my own code
- [ ] I have commented my code, particularly in hard-to-understand areas
- [ ] I have made corresponding changes to the documentation
- [ ] My changes generate no new warnings or errors
- [ ] I have added tests that prove my fix is effective or that my feature works
- [ ] New and existing unit tests pass locally with my changes
- [ ] I have created a changeset (`pnpm changeset`)

## Changeset

<!-- Confirm you've created a changeset for this PR -->

- [ ] I have created a changeset for these changes

## Additional Notes

<!-- Add any additional notes, concerns, or discussion points -->
`````

## File: .github/SECURITY.md
`````markdown
# Reporting Security Issues

If you believe you have found a security vulnerability in the Streamdown, we encourage you to let us know right away.

We will investigate all legitimate reports and do our best to quickly fix the problem.

Email `security@vercel.com` to disclose any security vulnerabilities.

https://vercel.com/security
`````

## File: apps/test/app/api/chat/route.ts
`````typescript
import { convertToModelMessages, streamText, type UIMessage } from 'ai';
// Allow streaming responses up to 30 seconds
⋮----
export async function POST(req: Request)
`````

## File: apps/test/app/globals.css
`````css
@source "../node_modules/streamdown/dist/index.js";
@theme inline {
:root {
.dark {
@layer base {
⋮----
* {
body {
`````

## File: apps/test/app/layout.tsx
`````typescript
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
⋮----
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>)
`````

## File: apps/test/app/page.tsx
`````typescript
import { useChat } from '@ai-sdk/react';
import { DefaultChatTransport } from 'ai';
import { useState } from 'react';
import { Streamdown } from 'streamdown';
`````

## File: apps/test/lib/utils.ts
`````typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"
export function cn(...inputs: ClassValue[])
`````

## File: apps/test/.gitignore
`````
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
`````

## File: apps/test/components.json
`````json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
`````

## File: apps/test/next.config.ts
`````typescript
import type { NextConfig } from "next";
⋮----
/* config options here */
`````

## File: apps/test/package.json
`````json
{
  "name": "test",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build --turbopack",
    "start": "next start"
  },
  "dependencies": {
    "@ai-sdk/react": "^2.0.27",
    "ai": "^5.0.27",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.542.0",
    "next": "15.4.7",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "streamdown": "workspace:*",
    "tailwind-merge": "^3.3.1",
    "zod": "^4.1.4"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.6",
    "typescript": "^5"
  }
}
`````

## File: apps/test/postcss.config.mjs
`````

`````

## File: apps/test/tsconfig.json
`````json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
`````

## File: apps/website/.cursor/rules/ultracite.mdc
`````
---
description: Ultracite Rules - AI-Ready Formatter and Linter
globs: "**/*.{ts,tsx,js,jsx}"
alwaysApply: true
---

# Project Context
Ultracite enforces strict type safety, accessibility standards, and consistent code quality for JavaScript/TypeScript projects using Biome's lightning-fast formatter and linter.

## Key Principles
- Zero configuration required
- Subsecond performance
- Maximum type safety
- AI-friendly code generation

## Before Writing Code
1. Analyze existing patterns in the codebase
2. Consider edge cases and error scenarios
3. Follow the rules below strictly
4. Validate accessibility requirements

## Rules

### Accessibility (a11y)
- Don't use `accessKey` attribute on any HTML element.
- Don't set `aria-hidden="true"` on focusable elements.
- Don't add ARIA roles, states, and properties to elements that don't support them.
- Don't use distracting elements like `<marquee>` or `<blink>`.
- Only use the `scope` prop on `<th>` elements.
- Don't assign non-interactive ARIA roles to interactive HTML elements.
- Make sure label elements have text content and are associated with an input.
- Don't assign interactive ARIA roles to non-interactive HTML elements.
- Don't assign `tabIndex` to non-interactive HTML elements.
- Don't use positive integers for `tabIndex` property.
- Don't include "image", "picture", or "photo" in img alt prop.
- Don't use explicit role property that's the same as the implicit/default role.
- Make static elements with click handlers use a valid role attribute.
- Always include a `title` element for SVG elements.
- Give all elements requiring alt text meaningful information for screen readers.
- Make sure anchors have content that's accessible to screen readers.
- Assign `tabIndex` to non-interactive HTML elements with `aria-activedescendant`.
- Include all required ARIA attributes for elements with ARIA roles.
- Make sure ARIA properties are valid for the element's supported roles.
- Always include a `type` attribute for button elements.
- Make elements with interactive roles and handlers focusable.
- Give heading elements content that's accessible to screen readers (not hidden with `aria-hidden`).
- Always include a `lang` attribute on the html element.
- Always include a `title` attribute for iframe elements.
- Accompany `onClick` with at least one of: `onKeyUp`, `onKeyDown`, or `onKeyPress`.
- Accompany `onMouseOver`/`onMouseOut` with `onFocus`/`onBlur`.
- Include caption tracks for audio and video elements.
- Use semantic elements instead of role attributes in JSX.
- Make sure all anchors are valid and navigable.
- Ensure all ARIA properties (`aria-*`) are valid.
- Use valid, non-abstract ARIA roles for elements with ARIA roles.
- Use valid ARIA state and property values.
- Use valid values for the `autocomplete` attribute on input elements.
- Use correct ISO language/country codes for the `lang` attribute.

### Code Complexity and Quality
- Don't use consecutive spaces in regular expression literals.
- Don't use the `arguments` object.
- Don't use primitive type aliases or misleading types.
- Don't use the comma operator.
- Don't use empty type parameters in type aliases and interfaces.
- Don't write functions that exceed a given Cognitive Complexity score.
- Don't nest describe() blocks too deeply in test files.
- Don't use unnecessary boolean casts.
- Don't use unnecessary callbacks with flatMap.
- Use for...of statements instead of Array.forEach.
- Don't create classes that only have static members (like a static namespace).
- Don't use this and super in static contexts.
- Don't use unnecessary catch clauses.
- Don't use unnecessary constructors.
- Don't use unnecessary continue statements.
- Don't export empty modules that don't change anything.
- Don't use unnecessary escape sequences in regular expression literals.
- Don't use unnecessary fragments.
- Don't use unnecessary labels.
- Don't use unnecessary nested block statements.
- Don't rename imports, exports, and destructured assignments to the same name.
- Don't use unnecessary string or template literal concatenation.
- Don't use String.raw in template literals when there are no escape sequences.
- Don't use useless case statements in switch statements.
- Don't use ternary operators when simpler alternatives exist.
- Don't use useless `this` aliasing.
- Don't use any or unknown as type constraints.
- Don't initialize variables to undefined.
- Don't use the void operators (they're not familiar).
- Use arrow functions instead of function expressions.
- Use Date.now() to get milliseconds since the Unix Epoch.
- Use .flatMap() instead of map().flat() when possible.
- Use literal property access instead of computed property access.
- Don't use parseInt() or Number.parseInt() when binary, octal, or hexadecimal literals work.
- Use concise optional chaining instead of chained logical expressions.
- Use regular expression literals instead of the RegExp constructor when possible.
- Don't use number literal object member names that aren't base 10 or use underscore separators.
- Remove redundant terms from logical expressions.
- Use while loops instead of for loops when you don't need initializer and update expressions.
- Don't pass children as props.
- Don't reassign const variables.
- Don't use constant expressions in conditions.
- Don't use `Math.min` and `Math.max` to clamp values when the result is constant.
- Don't return a value from a constructor.
- Don't use empty character classes in regular expression literals.
- Don't use empty destructuring patterns.
- Don't call global object properties as functions.
- Don't declare functions and vars that are accessible outside their block.
- Make sure builtins are correctly instantiated.
- Don't use super() incorrectly inside classes. Also check that super() is called in classes that extend other constructors.
- Don't use variables and function parameters before they're declared.
- Don't use 8 and 9 escape sequences in string literals.
- Don't use literal numbers that lose precision.

### React and JSX Best Practices
- Don't use the return value of React.render.
- Make sure all dependencies are correctly specified in React hooks.
- Make sure all React hooks are called from the top level of component functions.
- Don't forget key props in iterators and collection literals.
- Don't destructure props inside JSX components in Solid projects.
- Don't define React components inside other components.
- Don't use event handlers on non-interactive elements.
- Don't assign to React component props.
- Don't use both `children` and `dangerouslySetInnerHTML` props on the same element.
- Don't use dangerous JSX props.
- Don't use Array index in keys.
- Don't insert comments as text nodes.
- Don't assign JSX properties multiple times.
- Don't add extra closing tags for components without children.
- Use `<>...</>` instead of `<Fragment>...</Fragment>`.
- Watch out for possible "wrong" semicolons inside JSX elements.

### Correctness and Safety
- Don't assign a value to itself.
- Don't return a value from a setter.
- Don't compare expressions that modify string case with non-compliant values.
- Don't use lexical declarations in switch clauses.
- Don't use variables that haven't been declared in the document.
- Don't write unreachable code.
- Make sure super() is called exactly once on every code path in a class constructor before this is accessed if the class has a superclass.
- Don't use control flow statements in finally blocks.
- Don't use optional chaining where undefined values aren't allowed.
- Don't have unused function parameters.
- Don't have unused imports.
- Don't have unused labels.
- Don't have unused private class members.
- Don't have unused variables.
- Make sure void (self-closing) elements don't have children.
- Don't return a value from a function with the return type 'void'
- Use isNaN() when checking for NaN.
- Make sure "for" loop update clauses move the counter in the right direction.
- Make sure typeof expressions are compared to valid values.
- Make sure generator functions contain yield.
- Don't use await inside loops.
- Don't use bitwise operators.
- Don't use expressions where the operation doesn't change the value.
- Make sure Promise-like statements are handled appropriately.
- Don't use __dirname and __filename in the global scope.
- Prevent import cycles.
- Don't use configured elements.
- Don't hardcode sensitive data like API keys and tokens.
- Don't let variable declarations shadow variables from outer scopes.
- Don't use the TypeScript directive @ts-ignore.
- Prevent duplicate polyfills from Polyfill.io.
- Don't use useless backreferences in regular expressions that always match empty strings.
- Don't use unnecessary escapes in string literals.
- Don't use useless undefined.
- Make sure getters and setters for the same property are next to each other in class and object definitions.
- Make sure object literals are declared consistently (defaults to explicit definitions).
- Use static Response methods instead of new Response() constructor when possible.
- Make sure switch-case statements are exhaustive.
- Make sure the `preconnect` attribute is used when using Google Fonts.
- Use `Array#{indexOf,lastIndexOf}()` instead of `Array#{findIndex,findLastIndex}()` when looking for the index of an item.
- Make sure iterable callbacks return consistent values.
- Use `with { type: "json" }` for JSON module imports.
- Use numeric separators in numeric literals.
- Use object spread instead of `Object.assign()` when constructing new objects.
- Always use the radix argument when using `parseInt()`.
- Make sure JSDoc comment lines start with a single asterisk, except for the first one.
- Include a description parameter for `Symbol()`.
- Don't use spread (`...`) syntax on accumulators.
- Don't use the `delete` operator.
- Don't access namespace imports dynamically.
- Don't use namespace imports.
- Declare regex literals at the top level.
- Don't use `target="_blank"` without `rel="noopener"`.

### TypeScript Best Practices
- Don't use TypeScript enums.
- Don't export imported variables.
- Don't add type annotations to variables, parameters, and class properties that are initialized with literal expressions.
- Don't use TypeScript namespaces.
- Don't use non-null assertions with the `!` postfix operator.
- Don't use parameter properties in class constructors.
- Don't use user-defined types.
- Use `as const` instead of literal types and type annotations.
- Use either `T[]` or `Array<T>` consistently.
- Initialize each enum member value explicitly.
- Use `export type` for types.
- Use `import type` for types.
- Make sure all enum members are literal values.
- Don't use TypeScript const enum.
- Don't declare empty interfaces.
- Don't let variables evolve into any type through reassignments.
- Don't use the any type.
- Don't misuse the non-null assertion operator (!) in TypeScript files.
- Don't use implicit any type on variable declarations.
- Don't merge interfaces and classes unsafely.
- Don't use overload signatures that aren't next to each other.
- Use the namespace keyword instead of the module keyword to declare TypeScript namespaces.

### Style and Consistency
- Don't use global `eval()`.
- Don't use callbacks in asynchronous tests and hooks.
- Don't use negation in `if` statements that have `else` clauses.
- Don't use nested ternary expressions.
- Don't reassign function parameters.
- This rule lets you specify global variable names you don't want to use in your application.
- Don't use specified modules when loaded by import or require.
- Don't use constants whose value is the upper-case version of their name.
- Use `String.slice()` instead of `String.substr()` and `String.substring()`.
- Don't use template literals if you don't need interpolation or special-character handling.
- Don't use `else` blocks when the `if` block breaks early.
- Don't use yoda expressions.
- Don't use Array constructors.
- Use `at()` instead of integer index access.
- Follow curly brace conventions.
- Use `else if` instead of nested `if` statements in `else` clauses.
- Use single `if` statements instead of nested `if` clauses.
- Use `new` for all builtins except `String`, `Number`, and `Boolean`.
- Use consistent accessibility modifiers on class properties and methods.
- Use `const` declarations for variables that are only assigned once.
- Put default function parameters and optional function parameters last.
- Include a `default` clause in switch statements.
- Use the `**` operator instead of `Math.pow`.
- Use `for-of` loops when you need the index to extract an item from the iterated array.
- Use `node:assert/strict` over `node:assert`.
- Use the `node:` protocol for Node.js builtin modules.
- Use Number properties instead of global ones.
- Use assignment operator shorthand where possible.
- Use function types instead of object types with call signatures.
- Use template literals over string concatenation.
- Use `new` when throwing an error.
- Don't throw non-Error values.
- Use `String.trimStart()` and `String.trimEnd()` over `String.trimLeft()` and `String.trimRight()`.
- Use standard constants instead of approximated literals.
- Don't assign values in expressions.
- Don't use async functions as Promise executors.
- Don't reassign exceptions in catch clauses.
- Don't reassign class members.
- Don't compare against -0.
- Don't use labeled statements that aren't loops.
- Don't use void type outside of generic or return types.
- Don't use console.
- Don't use control characters and escape sequences that match control characters in regular expression literals.
- Don't use debugger.
- Don't assign directly to document.cookie.
- Use `===` and `!==`.
- Don't use duplicate case labels.
- Don't use duplicate class members.
- Don't use duplicate conditions in if-else-if chains.
- Don't use two keys with the same name inside objects.
- Don't use duplicate function parameter names.
- Don't have duplicate hooks in describe blocks.
- Don't use empty block statements and static blocks.
- Don't let switch clauses fall through.
- Don't reassign function declarations.
- Don't allow assignments to native objects and read-only global variables.
- Use Number.isFinite instead of global isFinite.
- Use Number.isNaN instead of global isNaN.
- Don't assign to imported bindings.
- Don't use irregular whitespace characters.
- Don't use labels that share a name with a variable.
- Don't use characters made with multiple code points in character class syntax.
- Make sure to use new and constructor properly.
- Don't use shorthand assign when the variable appears on both sides.
- Don't use octal escape sequences in string literals.
- Don't use Object.prototype builtins directly.
- Don't redeclare variables, functions, classes, and types in the same scope.
- Don't have redundant "use strict".
- Don't compare things where both sides are exactly the same.
- Don't let identifiers shadow restricted names.
- Don't use sparse arrays (arrays with holes).
- Don't use template literal placeholder syntax in regular strings.
- Don't use the then property.
- Don't use unsafe negation.
- Don't use var.
- Don't use with statements in non-strict contexts.
- Make sure async functions actually use await.
- Make sure default clauses in switch statements come last.
- Make sure to pass a message value when creating a built-in error.
- Make sure get methods always return a value.
- Use a recommended display strategy with Google Fonts.
- Make sure for-in loops include an if statement.
- Use Array.isArray() instead of instanceof Array.
- Make sure to use the digits argument with Number#toFixed().
- Make sure to use the "use strict" directive in script files.

### Next.js Specific Rules
- Don't use `<img>` elements in Next.js projects.
- Don't use `<head>` elements in Next.js projects.
- Don't import next/document outside of pages/_document.jsx in Next.js projects.
- Don't use the next/head module in pages/_document.js on Next.js projects.

### Testing Best Practices
- Don't use export or module.exports in test files.
- Don't use focused tests.
- Make sure the assertion function, like expect, is placed inside an it() function call.
- Don't use disabled tests.

## Common Tasks
- `npx ultracite init` - Initialize Ultracite in your project
- `npx ultracite format` - Format and fix code automatically
- `npx ultracite lint` - Check for issues without fixing

## Example: Error Handling
```typescript
// ✅ Good: Comprehensive error handling
try {
  const result = await fetchData();
  return { success: true, data: result };
} catch (error) {
  console.error('API call failed:', error);
  return { success: false, error: error.message };
}

// ❌ Bad: Swallowing errors
try {
  return await fetchData();
} catch (e) {
  console.log(e);
}
```
`````

## File: apps/website/.vscode/settings.json
`````json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[javascript]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[typescript]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[json]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[jsonc]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[css]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "[graphql]": {
    "editor.defaultFormatter": "biomejs.biome"
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "editor.formatOnSave": true,
  "editor.formatOnPaste": true,
  "emmet.showExpandedAbbreviation": "never",
  "editor.codeActionsOnSave": {
    "source.fixAll.biome": "explicit",
    "source.organizeImports.biome": "explicit"
  }
}
`````

## File: apps/website/app/components/code-blocks.tsx
`````typescript
import { Section } from './section';
⋮----
export const CodeBlocks = () => (
  <Section
    description={
      <>
        Streamdown uses{' '}
        <a
          className="underline"
          href="https://shiki.style/"
          rel="noreferrer"
          target="_blank"
        >
          Shiki
        </a>{' '}
        to highlight code blocks, and comes with a copy button so you can easily
        copy the code.{' '}
        <span className="font-medium text-blue-600">
          Hover to reveal the copy button!
        </span>
      </>
    }
    markdown={markdown}
    title="Beautiful, interactive code blocks"
  />
);
`````

## File: apps/website/app/components/cta.tsx
`````typescript
/** biome-ignore-all lint/suspicious/noArrayIndexKey: "required" */
import { cn } from '@/lib/utils';
import { Installer } from './installer';
`````

## File: apps/website/app/components/faq.tsx
`````typescript
import { CodeBlock } from '@/components/code-block';
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from '@/components/ui/accordion';
`````

## File: apps/website/app/components/footer.tsx
`````typescript
import { ModeToggle } from '@/components/mode-toggle';
export const Footer = () => (
  <footer className="px-4 py-8">
    <div className="flex items-center justify-between">
      <div className="text-muted-foreground text-sm">
        <p>
          Made with 🖤 and 🤖 by{' '}
          <a
            className="font-medium text-blue-600 underline"
            href="https://vercel.com"
            rel="noopener"
            target="_blank"
          >
            Vercel
          </a>
          . View the{' '}
          <a
            className="font-medium text-blue-600 underline"
            href="https://github.com/vercel/streamdown"
            rel="noopener"
            target="_blank"
          >
            source code
          </a>
          .
        </p>
      </div>
      <ModeToggle />
    </div>
  </footer>
);
`````

## File: apps/website/app/components/gfm.tsx
`````typescript
import { Section } from './section';
⋮----
export const GitHubFlavoredMarkdown = () => (
  <Section
    description="Streamdown supports GitHub Flavored Markdown (GFM) out of the box, so you get things like task lists, tables, and more."
    markdown={markdown}
    title="GitHub Flavored Markdown"
  />
);
`````

## File: apps/website/app/components/hardened.tsx
`````typescript
import { Section } from './section';
⋮----
href="https://vercel.com/blog/building-secure-ai-agents"
⋮----
defaultOrigin: 'https://streamdown.vercel.app',
allowedLinkPrefixes: ['https://streamdown.vercel.app'],
`````

## File: apps/website/app/components/header.tsx
`````typescript
import type { SVGProps } from 'react';
import { Installer } from './installer';
const Vercel = (props: SVGProps<SVGSVGElement>) => (
  <svg
    fill="none"
    viewBox="0 0 76 65"
    xmlns="http://www.w3.org/2000/svg"
    {...props}
  >
    <title>Vercel</title>
    <path d="M37.5274 0L75.0548 65H0L37.5274 0Z" fill="currentColor" />
  </svg>
);
⋮----
xmlns="http://www.w3.org/2000/svg"
⋮----
export const Header = () => (
  <div className="sticky top-0 z-10 flex items-center justify-between bg-secondary p-4 backdrop-blur-sm dark:bg-background">
    <div className="mx-auto flex items-center gap-1 sm:mx-0">
      <a className="flex items-center gap-1" href="https://vercel.com">
        <Vercel className="h-4 w-auto" />
        <span className="font-semibold sm:text-lg">Vercel</span>
      </a>
      <div className="text-muted-foreground sm:text-lg">/</div>
      <div className="text-muted-foreground sm:text-lg">Streamdown</div>
    </div>
    <div className="hidden md:block">
      <Installer />
    </div>
  </div>
);
`````

## File: apps/website/app/components/hero.tsx
`````typescript
/** biome-ignore-all lint/suspicious/noArrayIndexKey: "required" */
import { cn } from '@/lib/utils';
import { Installer } from './installer';
`````

## File: apps/website/app/components/implementation.tsx
`````typescript
import { CodeBlock, CodeBlockCopyButton } from '@/components/code-block';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
⋮----
export const Implementation = () => (
  <div className="divide-y sm:grid sm:grid-cols-3 sm:divide-x sm:divide-y-0">
    <div className="space-y-2 px-4 pt-8 pb-16 sm:p-8!">
      <h2 className="font-semibold text-2xl tracking-tight">Overview</h2>
      <p className="text-muted-foreground">
        Formatting Markdown is easy, but when you tokenize and stream it, new
        challenges arise.
      </p>
      <p className="text-muted-foreground">
        With{' '}
        <a
          className="font-medium text-blue-600 underline"
          href="https://ai-sdk.dev/elements"
          rel="noopener noreferrer"
          target="_blank"
        >
          AI Elements
        </a>
        , we wanted a way to stream safe and perfectly formatted Markdown
        without having to worry about the details.
      </p>
      <p className="text-muted-foreground">
        So we built Streamdown, a drop-in replacement for react-markdown,
        designed for AI-powered streaming.
      </p>
      <p className="text-muted-foreground">
        It powers the AI Elements{' '}
        <a
          className="font-medium text-blue-600 underline"
          href="https://ai-sdk.dev/elements/components/response"
          rel="noopener noreferrer"
          target="_blank"
        >
          Response
        </a>{' '}
        component, but you can install it as a standalone package if you want.
      </p>
    </div>
    <div className="relative bg-background sm:col-span-2">
      <Tabs defaultValue="elements">
        <div className="dark">
          <TabsList className="-translate-x-1/2 -translate-y-1/2 absolute top-0 left-1/2 rounded-full">
            <TabsTrigger className="rounded-full" value="elements">
              AI Elements
            </TabsTrigger>
            <TabsTrigger className="rounded-full" value="streamdown">
              Streamdown
            </TabsTrigger>
          </TabsList>
        </div>
        <TabsContent className="overflow-x-hidden" value="elements">
          <CodeBlock className="p-8" code={elementsCode} language="tsx">
            <CodeBlockCopyButton />
          </CodeBlock>
        </TabsContent>
        <TabsContent className="overflow-x-hidden" value="streamdown">
          <CodeBlock className="p-8" code={streamdownCode} language="tsx">
            <CodeBlockCopyButton />
          </CodeBlock>
        </TabsContent>
      </Tabs>
      <hr />
      <CodeBlock className="p-8" code={cssCode} language="css">
        <CodeBlockCopyButton />
      </CodeBlock>
    </div>
  </div>
);
`````

## File: apps/website/app/components/installer.tsx
`````typescript
import { track } from '@vercel/analytics/react';
import { CheckIcon, CopyIcon } from 'lucide-react';
import { useState } from 'react';
import { Button } from '@/components/ui/button';
⋮----
export const Installer = () =>
⋮----
const copyToClipboard = async () =>
`````

## File: apps/website/app/components/mathematics.tsx
`````typescript
import { Section } from './section';
⋮----
export const Mathematics = () => (
  <Section
    description="Streamdown supports LaTeX math expressions through remark-math and KaTeX, enabling beautiful mathematical notation in your markdown."
    markdown={markdown}
    title="Mathematical Expressions"
  />
);
`````

## File: apps/website/app/components/mermaid.tsx
`````typescript
import { Section } from './section';
`````

## File: apps/website/app/components/props.tsx
`````typescript

`````

## File: apps/website/app/components/section.tsx
`````typescript
import { RefreshCcwIcon } from 'lucide-react';
import { useInView } from 'motion/react';
import { type ReactNode, useEffect, useMemo, useRef, useState } from 'react';
import ReactMarkdown from 'react-markdown';
import { Streamdown, type StreamdownProps } from 'streamdown';
import { Button } from '@/components/ui/button';
⋮----
type SectionProps = {
  title: string;
  description: string | ReactNode;
  markdown: string;
  streamdownProps?: StreamdownProps;
  speed?: number;
};
⋮----
// Clear any existing interval
⋮----
// Reset content and start animation
⋮----
const reset = () =>
⋮----
// Stop current animation if running
⋮----
// Trigger re-run of animation
`````

## File: apps/website/app/components/styles.tsx
`````typescript
import { Section } from './section';
⋮----
export const Styles = () => (
  <Section
    description="Streamdown comes with built-in Tailwind classes for common Markdown components — headings, lists, code blocks, and more."
    markdown={markdown}
    title="Built-in typography styles"
  />
);
`````

## File: apps/website/app/components/terminator-parser.tsx
`````typescript
import { Section } from './section';
⋮----
export const TerminatorParser = () => (
  <Section
    description="Streamdown comes with built-in support for parsing unterminated Markdown blocks (# headings, `inline code`, **bold**, _italic_, [links]() and more), which makes streaming Markdown content much prettier."
    markdown={markdown}
    title="Style unterminated Markdown blocks"
  />
);
`````

## File: apps/website/app/globals.css
`````css
@source "../node_modules/streamdown/**/*.{ts,tsx}";
@theme inline {
:root {
.dark {
@layer base {
⋮----
* {
body {
.bg-dashed {
⋮----
.animate-accordion-down {
.animate-accordion-up {
`````

## File: apps/website/app/layout.tsx
`````typescript
import { Geist, Geist_Mono } from 'next/font/google';
⋮----
import { Analytics } from '@vercel/analytics/next';
import type { ReactNode } from 'react';
import { Providers } from '@/components/providers';
import { cn } from '@/lib/utils';
⋮----
type RootLayoutProps = {
  children: ReactNode;
};
`````

## File: apps/website/app/page.tsx
`````typescript
import type { Metadata } from 'next';
import { CodeBlocks } from './components/code-blocks';
import { CallToAction } from './components/cta';
import { FAQ } from './components/faq';
import { Footer } from './components/footer';
import { GitHubFlavoredMarkdown } from './components/gfm';
import { HardenedMarkdown } from './components/hardened';
import { Header } from './components/header';
import { Hero } from './components/hero';
import { Implementation } from './components/implementation';
import { Mathematics } from './components/mathematics';
import { MermaidDemo } from './components/mermaid';
import { Props } from './components/props';
import { Styles } from './components/styles';
import { TerminatorParser } from './components/terminator-parser';
`````

## File: apps/website/components/ui/accordion.tsx
`````typescript
import { ChevronDownIcon } from "lucide-react"
import { cn } from "@/lib/utils"
function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>)
⋮----
function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>)
⋮----
className=
⋮----
function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>)
`````

## File: apps/website/components/ui/button.tsx
`````typescript
import { Slot } from '@radix-ui/react-slot';
import { cva, type VariantProps } from 'class-variance-authority';
⋮----
import { cn } from '@/lib/utils';
`````

## File: apps/website/components/ui/tabs.tsx
`````typescript
import { cn } from "@/lib/utils"
⋮----
className=
`````

## File: apps/website/components/code-block.tsx
`````typescript
import { CheckIcon, CopyIcon } from 'lucide-react';
import {
  type ComponentProps,
  createContext,
  type HTMLAttributes,
  useContext,
  useEffect,
  useRef,
  useState,
} from 'react';
import { type BundledLanguage, codeToHtml } from 'shiki';
import { cn } from '@/lib/utils';
type CodeBlockProps = HTMLAttributes<HTMLDivElement> & {
  code: string;
  language: BundledLanguage;
};
type CodeBlockContextType = {
  code: string;
};
⋮----
export async function highlightCode(code: string, language: BundledLanguage)
⋮----
// biome-ignore lint/security/noDangerouslySetInnerHtml: "this is needed."
⋮----
// biome-ignore lint/security/noDangerouslySetInnerHtml: "this is needed."
`````

## File: apps/website/components/mode-toggle.tsx
`````typescript
import { Moon, Sun } from 'lucide-react';
import { useTheme } from 'next-themes';
import { useEffect, useState } from 'react';
import { Button } from '@/components/ui/button';
export function ModeToggle()
`````

## File: apps/website/components/providers.tsx
`````typescript
import { ThemeProvider } from 'next-themes';
import type { ReactNode } from 'react';
type ProvidersProps = {
  children: ReactNode;
};
export function Providers(
`````

## File: apps/website/lib/utils.ts
`````typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';
export function cn(...inputs: ClassValue[])
`````

## File: apps/website/public/file.svg
`````
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
`````

## File: apps/website/public/globe.svg
`````
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
`````

## File: apps/website/public/next.svg
`````
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
`````

## File: apps/website/public/vercel.svg
`````
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
`````

## File: apps/website/public/window.svg
`````
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
`````

## File: apps/website/.gitignore
`````
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
`````

## File: apps/website/components.json
`````json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
`````

## File: apps/website/next.config.ts
`````typescript
import type { NextConfig } from 'next';
⋮----
/* config options here */
`````

## File: apps/website/package.json
`````json
{
  "name": "website",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@radix-ui/react-accordion": "^1.2.12",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.13",
    "@vercel/analytics": "^1.5.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.539.0",
    "motion": "^12.23.12",
    "next": "15.4.7",
    "next-themes": "^0.4.6",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "react-markdown": "^10.1.0",
    "shiki": "^3.9.2",
    "streamdown": "workspace:*",
    "tailwind-merge": "^3.3.1"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.6",
    "typescript": "^5"
  }
}
`````

## File: apps/website/postcss.config.mjs
`````

`````

## File: apps/website/README.md
`````markdown
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
`````

## File: apps/website/tsconfig.json
`````json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "baseUrl": ".",
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"],
      "streamdown/*": ["../../packages/streamdown/*"]
    },
    "strictNullChecks": true
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
`````

## File: packages/streamdown/__tests__/code-block.test.tsx
`````typescript
import { act, fireEvent, render, waitFor } from '@testing-library/react';
import React from 'react';
import { describe, expect, it, vi, beforeEach, afterEach } from 'vitest';
import { CodeBlock, CodeBlockCopyButton } from '../lib/code-block';
⋮----
// Mock clipboard API
⋮----
// Check icon should be visible after copying
⋮----
// Mock clipboard API not available
⋮----
// Fast-forward time
⋮----
// Icon should be reset after timeout
`````

## File: packages/streamdown/__tests__/components.test.tsx
`````typescript
import { render } from '@testing-library/react';
import React from 'react';
import { describe, expect, it } from 'vitest';
import { components } from '../lib/components';
⋮----
// Block code renders a CodeBlock component with copy button
⋮----
// Should contain copy button
⋮----
// The pre component returns its children
// The code element should be present as a child
⋮----
// Test the code component directly since it handles language extraction
⋮----
// Code component with multi-line position renders a CodeBlock with language
⋮----
// The pre component returns its children directly
⋮----
// Wait for Mermaid chart to finish loading
⋮----
// Copy button should be present
⋮----
const hr = container.querySelector('hr');
expect(hr).toBeTruthy();
expect(hr?.className).toContain('my-6');
expect(hr?.className).toContain('border-border');
`````

## File: packages/streamdown/__tests__/dollar-sign.test.tsx
`````typescript
import { render } from '@testing-library/react';
import React from 'react';
import { describe, expect, it } from 'vitest';
import { Streamdown } from '../index';
⋮----
// Check if content is incorrectly wrapped in math elements
⋮----
// The text should be rendered as plain text, not math
⋮----
// Check that the dollar signs are preserved in the text
⋮----
// Check that both dollar amounts are preserved
⋮----
// Check that the single dollar sign is preserved without adding a trailing one
⋮----
// Block math should still work
⋮----
// With singleDollarTextMath: false, this should not render as math
⋮----
// Only the block math should render
`````

## File: packages/streamdown/__tests__/latex-begin-issue.test.tsx
`````typescript
import { render } from '@testing-library/react';
import React from 'react';
import { describe, expect, it } from 'vitest';
import { Streamdown } from '../index';
import { parseIncompleteMarkdown } from '../lib/parse-incomplete-markdown';
import { parseMarkdownIntoBlocks } from '../lib/parse-blocks';
⋮----
// Test how marked splits this content
⋮----
// Test parseIncompleteMarkdown on each block
⋮----
// Check that the LaTeX is rendered correctly
⋮----
// Check the text content doesn't have extra $$ appended
⋮----
// Should not contain $$$$ (four dollar signs in a row)
⋮----
// Check that the LaTeX is rendered correctly
⋮----
// Should close the incomplete block with $$
⋮----
// Check that the LaTeX is rendered
`````

## File: packages/streamdown/__tests__/matrix-equation.test.tsx
`````typescript
import { render } from '@testing-library/react';
import React from 'react';
import { describe, expect, it } from 'vitest';
import { Streamdown } from '../index';
import { parseMarkdownIntoBlocks } from '../lib/parse-blocks';
import { parseIncompleteMarkdown } from '../lib/parse-incomplete-markdown';
⋮----
// Check how the content is split into blocks
⋮----
// Check that the LaTeX is rendered correctly
`````

## File: packages/streamdown/__tests__/mermaid.test.tsx
`````typescript
import { render } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { Mermaid } from '../lib/mermaid';
// Mock mermaid
`````

## File: packages/streamdown/__tests__/parse-incomplete-markdown.test.ts
`````typescript
import { describe, expect, it } from 'vitest';
import { parseIncompleteMarkdown } from '../lib/parse-incomplete-markdown';
⋮----
// Single dollar signs are likely currency, not math
⋮----
// Even paired dollar signs are preserved but not treated as math
⋮----
// We don't auto-complete dollar signs anymore
⋮----
// Block math $$ is completed, single $ is not
⋮----
// Single dollar sign is likely currency
⋮----
// Bug report: This was being rendered with extra characters at the end
⋮----
// Bug report: This was being rendered with **_ appended
⋮----
// This is the exact case from Grok
⋮----
// This was causing issues - being treated as inline when it should be multiline
⋮----
// Should NOT be treated as inline triple backticks
⋮----
expect(result).not.toContain('````'); // Should not add extra backticks
⋮----
// This SHOULD be treated as inline (no newlines)
⋮----
// This should NOT be treated as inline (has newline)
⋮----
// Links with partial URLs are kept as-is since they might be complete
⋮----
// Images with partial URLs are kept as-is since they might be complete
⋮----
// When bold is unclosed, it gets closed first, then underscore
⋮----
// Backticks spanning multiple lines need special handling
⋮----
// Formats are closed in order they're processed
⋮----
// Bold gets closed first, then code
⋮----
// Both formats get closed
⋮----
// Bold gets closed, dollar sign stays as-is (likely currency)
⋮----
// Formats are closed in the order they're processed
⋮----
// Single dollar signs are not auto-completed (likely currency)
⋮----
// We no longer auto-complete single dollar signs
// The underscore inside is not treated as italic since it's likely part of a variable name
⋮----
// List markers are not counted, but incomplete italic formatting is still completed
⋮----
// The function adds an asterisk to complete the italic, though at the end of text
// This is not ideal but matches current behavior
⋮----
expect(parseIncompleteMarkdown('text$')).toBe('text$'); // Single dollar not completed
`````

## File: packages/streamdown/__tests__/setup.ts
`````typescript
import { cleanup } from '@testing-library/react';
import { afterEach, expect } from 'vitest';
// Extend Vitest's expect with jest-dom matchers
⋮----
// Cleanup after each test
`````

## File: packages/streamdown/__tests__/streamdown.test.tsx
`````typescript
import { render, screen } from '@testing-library/react';
import React from 'react';
import { describe, expect, it, vi } from 'vitest';
import { Streamdown } from '../index';
// Mock the dependencies
⋮----
// Only render if children is provided
⋮----
// Non-string children get converted to empty string, so no blocks are created
⋮----
// These props are passed to child Block components, not to the wrapper div
⋮----
// These props are passed to child Block components, not to the wrapper div
⋮----
// This prop is passed to child Block components, not to the wrapper div
⋮----
// The markdown might not render synchronously, let's check the wrapper exists
⋮----
// Check if any h1 exists at all (custom or default)
⋮----
// If h1 exists, it should have the custom class
⋮----
// The component renders but heading might be parsed differently
⋮----
const customPlugin = () =>
⋮----
// Same children, different prop - should not re-render (memoized)
⋮----
// Different children - should re-render
⋮----
// Empty string results in no blocks
⋮----
// Null children get converted to empty string, so no blocks are created
⋮----
// Undefined children get converted to empty string, so no blocks are created
⋮----
// Numbers get converted to empty string, so no blocks are created
⋮----
// Check that incomplete markdown is parsed correctly
// The content is split into blocks and rendered separately
`````

## File: packages/streamdown/__tests__/utils.test.ts
`````typescript
import { describe, expect, it } from 'vitest';
import { cn } from '../lib/utils';
`````

## File: packages/streamdown/lib/code-block.tsx
`````typescript
import { CheckIcon, CopyIcon } from 'lucide-react';
import {
  type ComponentProps,
  createContext,
  type HTMLAttributes,
  useContext,
  useEffect,
  useRef,
  useState,
} from 'react';
import {
  type BundledLanguage,
  type BundledTheme,
  createHighlighter,
} from 'shiki';
import { createJavaScriptRegexEngine } from 'shiki/engine/javascript';
import { ShikiThemeContext } from '../index';
import { cn } from './utils';
⋮----
type CodeBlockProps = HTMLAttributes<HTMLDivElement> & {
  code: string;
  language: BundledLanguage;
  preClassName?: string;
};
type CodeBlockContextType = {
  code: string;
};
⋮----
export async function highlightCode(
  code: string,
  language: BundledLanguage,
  themes: [BundledTheme, BundledTheme],
  preClassName?: string
)
⋮----
const addPreClass = (html: string) =>
⋮----
// Remove background styles from <pre> tags (inline style)
function removePreBackground(html: string)
⋮----
// biome-ignore lint/security/noDangerouslySetInnerHtml: "this is needed."
⋮----
// biome-ignore lint/security/noDangerouslySetInnerHtml: "this is needed."
⋮----
className=
`````

## File: packages/streamdown/lib/components.tsx
`````typescript
import {
  type DetailedHTMLProps,
  type HTMLAttributes,
  isValidElement,
} from 'react';
import type { ExtraProps, Options } from 'react-markdown';
import type { BundledLanguage } from 'shiki';
import { CodeBlock, CodeBlockCopyButton } from './code-block';
import { Mermaid } from './mermaid';
import { cn } from './utils';
⋮----
// Extract code content from children safely
`````

## File: packages/streamdown/lib/mermaid.tsx
`````typescript
import { useEffect, useState } from 'react';
import { cn } from './utils';
// Global mermaid initialization
⋮----
const initializeMermaid = async () =>
type MermaidProps = {
  chart: string;
  className?: string;
};
⋮----
// biome-ignore lint/correctness/useExhaustiveDependencies: "Required for Mermaid"
⋮----
const renderChart = async () =>
⋮----
// Initialize mermaid only once globally
⋮----
// Use a stable ID based on chart content hash and timestamp to ensure uniqueness
⋮----
// biome-ignore lint/suspicious/noBitwiseOperators: "Required for Mermaid"
⋮----
// Update both current and last valid SVG
⋮----
// Silently fail and keep the last valid SVG
// Don't update svgContent here - just keep what we have
// Only set error if we don't have any valid SVG
⋮----
// Show loading only on initial load when we have no content
⋮----
// Only show error if we have no valid SVG to display
⋮----
// Always render the SVG if we have content (either current or last valid)
⋮----
// biome-ignore lint/security/noDangerouslySetInnerHtml: "Required for Mermaid"
`````

## File: packages/streamdown/lib/parse-blocks.tsx
`````typescript
import { marked } from 'marked';
export const parseMarkdownIntoBlocks = (markdown: string): string[] =>
⋮----
// Post-process to merge consecutive blocks that are part of the same math block
⋮----
// Check if this is a standalone $$ that might be a closing delimiter
⋮----
// Check if the previous block starts with $$ but doesn't end with $$
⋮----
// If previous block has odd number of $$ and starts with $$, merge them
⋮----
// Check if current block ends with $$ and previous block started with $$ but didn't close
⋮----
// If previous block has unclosed math (odd $$) and current block ends with $$
// AND current block doesn't start with $$, it's likely a continuation
`````

## File: packages/streamdown/lib/parse-incomplete-markdown.ts
`````typescript
// Removed inlineKatexPattern - no longer processing single dollar signs
⋮----
// Helper function to check if we have a complete code block
const hasCompleteCodeBlock = (text: string): boolean =>
// Handles incomplete links and images by removing them if not closed
const handleIncompleteLinksAndImages = (text: string): string =>
// Completes incomplete bold formatting (**)
const handleIncompleteBold = (text: string): string =>
⋮----
// Don't process if inside a complete code block
⋮----
// Completes incomplete italic formatting with double underscores (__)
const handleIncompleteDoubleUnderscoreItalic = (text: string): string =>
// Counts single asterisks that are not part of double asterisks, not escaped, and not list markers
const countSingleAsterisks = (text: string): number =>
⋮----
// Skip if escaped with backslash
⋮----
// Check if this is a list marker (asterisk at start of line followed by space)
// Look backwards to find the start of the current line
⋮----
// Check if this asterisk is at the beginning of a line (with optional whitespace)
⋮----
// This is likely a list marker, don't count it
⋮----
// Completes incomplete italic formatting with single asterisks (*)
const handleIncompleteSingleAsteriskItalic = (text: string): string =>
⋮----
// Don't process if inside a complete code block
⋮----
// Check if a position is within a math block (between $ or $$)
const isWithinMathBlock = (text: string, position: number): boolean =>
⋮----
// Count dollar signs before this position
⋮----
// Skip escaped dollar signs
⋮----
i++; // Skip the next character
⋮----
// Check for block math ($$)
⋮----
i++; // Skip the second $
inInlineMath = false; // Block math takes precedence
⋮----
// Only toggle inline math if not in block math
⋮----
// Counts single underscores that are not part of double underscores, not escaped, and not in math blocks
const countSingleUnderscores = (text: string): number =>
⋮----
// Skip if escaped with backslash
⋮----
// Skip if within math block
⋮----
// Completes incomplete italic formatting with single underscores (_)
const handleIncompleteSingleUnderscoreItalic = (text: string): string =>
⋮----
// Don't process if inside a complete code block
⋮----
// Checks if a backtick at position i is part of a triple backtick sequence
const isPartOfTripleBacktick = (text: string, i: number): boolean =>
// Counts single backticks that are not part of triple backticks
const countSingleBackticks = (text: string): number =>
// Completes incomplete inline code formatting (`)
// Avoids completing if inside an incomplete code block
const handleIncompleteInlineCode = (text: string): string =>
⋮----
// Check if we have inline triple backticks (starts with ``` and should end with ```)
// This pattern should ONLY match truly inline code (no newlines)
// Examples: ```code``` or ```python code```
⋮----
// Check if it ends with exactly 2 backticks (incomplete)
⋮----
// Already complete inline triple backticks
⋮----
// Check if we're inside a multi-line code block (complete or incomplete)
⋮----
// Don't modify text if we have complete multi-line code blocks (even pairs of ```)
⋮----
// We have complete multi-line code blocks, don't add any backticks
⋮----
// Special case: if text ends with ```\n (triple backticks followed by newline)
// This is actually a complete code block, not incomplete
⋮----
// Count all triple backticks - if even, it's complete
⋮----
// Completes incomplete strikethrough formatting (~~)
const handleIncompleteStrikethrough = (text: string): string =>
// Counts single dollar signs that are not part of double dollar signs and not escaped
const countSingleDollarSigns = (text: string): number =>
⋮----
// Skip if escaped with backslash
⋮----
// Completes incomplete block KaTeX formatting ($$)
const handleIncompleteBlockKatex = (text: string): string =>
⋮----
// Count all $$ pairs in the text
⋮----
// If we have an even number of $$, the block is complete
⋮----
// If we have an odd number, add closing $$
// Check if this looks like a multi-line math block (contains newlines after opening $$)
⋮----
// For multi-line blocks, add newline before closing $$ if not present
⋮----
// For inline blocks or when already ending with newline, just add $$
⋮----
// Completes incomplete inline KaTeX formatting ($)
// Note: Since we've disabled single dollar math delimiters in remarkMath,
// we should not auto-complete single dollar signs as they're likely currency symbols
const handleIncompleteInlineKatex = (text: string): string =>
⋮----
// Don't process single dollar signs - they're likely currency symbols, not math
// Only process block math ($$) which is handled separately
⋮----
// Counts triple asterisks that are not part of quadruple or more asterisks
const countTripleAsterisks = (text: string): number =>
⋮----
// Count how many complete triple asterisks are in this sequence
⋮----
// Each group of exactly 3 asterisks counts as one triple asterisk marker
⋮----
// Completes incomplete bold-italic formatting (***)
const handleIncompleteBoldItalic = (text: string): string =>
⋮----
// Don't process if inside a complete code block
⋮----
// Don't process if text is only asterisks and has 4 or more consecutive asterisks
// This prevents cases like **** from being treated as incomplete ***
⋮----
// Parses markdown text and removes incomplete tokens to prevent partial rendering
export const parseIncompleteMarkdown = (text: string): string =>
⋮----
// Handle incomplete links and images first (removes content)
⋮----
// Handle various formatting completions
// Handle triple asterisks first (most specific)
⋮----
// Handle KaTeX formatting (only block math with $$)
⋮----
// Note: We don't handle inline KaTeX with single $ as they're likely currency symbols
`````

## File: packages/streamdown/lib/utils.ts
`````typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';
export const cn = (...inputs: ClassValue[])
`````

## File: packages/streamdown/CHANGELOG.md
`````markdown
# streamdown

## 1.1.7

### Patch Changes

- e7f0402: Redesign CodeBlock for improved UX
- 6e0f722: use javascript regex engine for shiki
- 6751cbb: fix katex post-processing

## 1.1.6

### Patch Changes

- e01669b: add test app, fix code block incomplete parsing
- 69fb1e0: fix single dollar sign text rendering as math

## 1.1.5

### Patch Changes

- 593e49e: fix multiple renders of the same mermaid diagram
- bf8c798: update props in readme

## 1.1.4

### Patch Changes

- 5fbad80: fix asterisk list termination
- 13898aa: Add data-streamdown attributes to components
- 390bbc7: temporary fix for error color in rehype katex
- 5f4ed3d: chore: remove package-lock.json
- 9b5b56d: enable release-based web deploys

## 1.1.2

### Patch Changes

- 045907f: fix: handleIncompleteSingleUnderscoreItalic is not accounting for the usage inside math equations
- dc9ab5f: fix unit tests, run on release and PR
- 01e5eb0: Add Publishing CI Pipeline
- f834892: fix: codeblock dark mode and background
`````

## File: packages/streamdown/index.tsx
`````typescript
import { createContext, memo, useId, useMemo } from 'react';
import ReactMarkdown, { type Options } from 'react-markdown';
import rehypeKatex from 'rehype-katex';
import remarkGfm from 'remark-gfm';
import remarkMath from 'remark-math';
import type { BundledTheme } from 'shiki';
⋮----
import hardenReactMarkdownImport from 'harden-react-markdown';
import { components as defaultComponents } from './lib/components';
import { parseMarkdownIntoBlocks } from './lib/parse-blocks';
import { parseIncompleteMarkdown } from './lib/parse-incomplete-markdown';
import { cn } from './lib/utils';
type HardenReactMarkdownProps = Options & {
  defaultOrigin?: string;
  allowedLinkPrefixes?: string[];
  allowedImagePrefixes?: string[];
};
// Handle both ESM and CJS imports
⋮----
// biome-ignore lint/suspicious/noExplicitAny: "this is needed."
⋮----
// Create a hardened version of ReactMarkdown
⋮----
export type StreamdownProps = HardenReactMarkdownProps & {
  parseIncompleteMarkdown?: boolean;
  className?: string;
  shikiTheme?: [BundledTheme, BundledTheme];
};
⋮----
type BlockProps = HardenReactMarkdownProps & {
  content: string;
  shouldParseIncompleteMarkdown: boolean;
};
⋮----
// Parse the children to remove incomplete markdown tokens if enabled
⋮----
// biome-ignore lint/suspicious/noArrayIndexKey: "required"
`````

## File: packages/streamdown/package.json
`````json
{
  "name": "streamdown",
  "version": "1.1.7",
  "type": "module",
  "main": "./dist/index.js",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "require": "./dist/index.cjs"
    }
  },
  "files": [
    "dist",
    "README.md"
  ],
  "homepage": "https://streamdown.ai",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/vercel/streamdown.git",
    "directory": "packages/streamdown"
  },
  "scripts": {
    "build": "tsup",
    "test": "vitest run",
    "test:ui": "vitest --ui run",
    "test:coverage": "vitest --coverage run"
  },
  "author": "Hayden Bleasel <hayden.bleasel@vercel.com>",
  "license": "Apache-2.0",
  "description": "A drop-in replacement for react-markdown, designed for AI-powered streaming.",
  "devDependencies": {
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.1.0",
    "@types/react": "^19.1.10",
    "@types/react-dom": "^19.1.7",
    "@vitejs/plugin-react": "^5.0.0",
    "@vitest/coverage-v8": "^3.2.4",
    "jsdom": "^25.0.1",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "tsup": "^8.5.0",
    "vitest": "^3.2.4"
  },
  "peerDependencies": {
    "react": "^18.0.0 || ^19.0.0"
  },
  "dependencies": {
    "clsx": "^2.1.1",
    "harden-react-markdown": "^1.0.4",
    "katex": "^0.16.22",
    "lucide-react": "^0.541.0",
    "marked": "^16.1.2",
    "mermaid": "^11.0.0",
    "react-markdown": "^10.1.0",
    "rehype-katex": "^7.0.1",
    "remark-gfm": "^4.0.1",
    "remark-math": "^6.0.0",
    "shiki": "^3.9.2",
    "tailwind-merge": "^3.3.1"
  }
}
`````

## File: packages/streamdown/README.md
`````markdown
# Streamdown

A drop-in replacement for react-markdown, designed for AI-powered streaming.

[![npm version](https://img.shields.io/npm/v/streamdown)](https://www.npmjs.com/package/streamdown)

## Overview

Formatting Markdown is easy, but when you tokenize and stream it, new challenges arise. Streamdown is built specifically to handle the unique requirements of streaming Markdown content from AI models, providing seamless formatting even with incomplete or unterminated Markdown blocks.

Streamdown powers the [AI Elements Response](https://ai-sdk.dev/elements/components/response) component but can be installed as a standalone package for your own streaming needs.

## Features

- 🚀 **Drop-in replacement** for `react-markdown`
- 🔄 **Streaming-optimized** - Handles incomplete Markdown gracefully
- 🎨 **Unterminated block parsing** - Styles incomplete bold, italic, code, links, and headings
- 📊 **GitHub Flavored Markdown** - Tables, task lists, and strikethrough support
- 🔢 **Math rendering** - LaTeX equations via KaTeX
- 📈 **Mermaid diagrams** - Render Mermaid diagrams as code blocks with a button to render them
- 🎯 **Code syntax highlighting** - Beautiful code blocks with Shiki
- 🛡️ **Security-first** - Built on harden-react-markdown for safe rendering
- ⚡ **Performance optimized** - Memoized rendering for efficient updates

## Installation

```bash
npm i streamdown
```

Then, update your Tailwind `globals.css` to include the following.

```css
@source "../node_modules/streamdown/dist/index.js";
```

Make sure the path matches the location of the `node_modules` folder in your project. This will ensure that the Streamdown styles are applied to your project.

## Usage

### Basic Example

```tsx
import { Streamdown } from 'streamdown';

export default function Page() {
  const markdown = "# Hello World\n\nThis is **streaming** markdown!";

  return <Streamdown>{markdown}</Streamdown>;
}
```

### Mermaid Diagrams

Streamdown supports Mermaid diagrams using the `mermaid` language identifier:

```tsx
import { Streamdown } from 'streamdown';

export default function Page() {
  const markdown = `
# Flowchart Example

\`\`\`mermaid
graph TD
    A[Start] --> B{Is it working?}
    B -->|Yes| C[Great!]
    B -->|No| D[Debug]
    D --> B
\`\`\`

# Sequence Diagram

\`\`\`mermaid
sequenceDiagram
    participant User
    participant API
    participant Database

    User->>API: Request data
    API->>Database: Query
    Database-->>API: Results
    API-->>User: Response
\`\`\`
  `;

  return <Streamdown>{markdown}</Streamdown>;
}
```

### With AI SDK

```tsx
'use client';

import { useChat } from '@ai-sdk/react';
import { useState } from 'react';
import { Streamdown } from 'streamdown';

export default function Page() {
  const { messages, sendMessage, status } = useChat();
  const [input, setInput] = useState('');

  return (
    <>
      {messages.map(message => (
        <div key={message.id}>
          {message.parts.filter(part => part.type === 'text').map((part, index) => (
            <Streamdown key={index}>{part.text}</Streamdown>
          ))}
        </div>
      ))}

      <form
        onSubmit={e => {
          e.preventDefault();
          if (input.trim()) {
            sendMessage({ text: input });
            setInput('');
          }
        }}
      >
        <input
          value={input}
          onChange={e => setInput(e.target.value)}
          disabled={status !== 'ready'}
          placeholder="Say something..."
        />
        <button type="submit" disabled={status !== 'ready'}>
          Submit
        </button>
      </form>
    </>
  );
}
```

## Props

Streamdown accepts all the same props as react-markdown, plus additional streaming-specific options:

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `children` | `string` | - | The Markdown content to render |
| `parseIncompleteMarkdown` | `boolean` | `true` | Parse and style unterminated Markdown blocks |
| `className` | `string` | - | CSS class for the container |
| `components` | `object` | - | Custom component overrides |
| `remarkPlugins` | `array` | `[remarkGfm, remarkMath]` | Remark plugins to use |
| `rehypePlugins` | `array` | `[rehypeKatex]` | Rehype plugins to use |
| `allowedImagePrefixes` | `array` | `['*']` | Allowed image URL prefixes |
| `allowedLinkPrefixes` | `array` | `['*']` | Allowed link URL prefixes |
| `defaultOrigin` | `string` | - | Default origin to use for relative URLs in links and images |
| `shikiTheme` | `BundledTheme` (from Shiki) | `github-light` | The theme to use for code blocks |

## Architecture

Streamdown is built as a monorepo with:

- **`packages/streamdown`** - The core React component library
- **`apps/website`** - Documentation and demo site

## Development

```bash
# Install dependencies
pnpm install

# Build the streamdown package
pnpm --filter streamdown build

# Run development server
pnpm dev

# Run tests
pnpm test

# Build packages
pnpm build
```

## Requirements

- Node.js >= 18
- React >= 19.1.1

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.
`````

## File: packages/streamdown/tsconfig.json
`````json
{
  "compilerOptions": {
    "target": "es2018",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "strictNullChecks": true,
    "forceConsistentCasingInFileNames": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "noEmit": true
  },
  "include": ["**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules", "build", "dist"]
}
`````

## File: packages/streamdown/tsup.config.ts
`````typescript
import { defineConfig } from 'tsup';
`````

## File: packages/streamdown/vitest.config.ts
`````typescript
import react from '@vitejs/plugin-react';
import path from 'path';
import { defineConfig } from 'vitest/config';
`````

## File: .gitattributes
`````
# Auto detect text files and perform LF normalization
* text=auto
`````

## File: .gitignore
`````
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# Dependencies
node_modules
.pnp
.pnp.js

# Local env files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Testing
coverage

# Turbo
.turbo

# Vercel
.vercel

# Build Outputs
.next/
out/
build
dist


# Debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Misc
.DS_Store
*.pem

# Prevent accidental npm lockfiles in pnpm monorepo
package-lock.json
**/package-lock.json
`````

## File: biome.jsonc
`````
{
  "$schema": "https://biomejs.dev/schemas/2.2.0/schema.json",
  "extends": ["ultracite"]
}
`````

## File: CODE_OF_CONDUCT.md
`````markdown
# Vercel Community Code of Conduct

Please see https://community.vercel.com/guidelines for the latest version.
`````

## File: CONTRIBUTING.md
`````markdown
# Contributing to Streamdown

Thank you for your interest in contributing to Streamdown! We welcome contributions from the community.

## Getting Started

### Prerequisites

- Node.js 18 or higher
- pnpm 9.0.0 (specified in packageManager field)

### Setup

1. Fork the repository
2. Clone your fork:
   ```bash
   git clone https://github.com/your-username/streamdown.git
   cd streamdown
   ```
3. Install dependencies:
   ```bash
   pnpm install
   ```
4. Run the tests to ensure everything is working:
   ```bash
   pnpm test
   ```

## Development Workflow

### Project Structure

This is a monorepo managed with Turbo. The main package is located at:
- `packages/streamdown/` - The core Streamdown React component library

### Available Scripts

- `pnpm dev` - Start development mode
- `pnpm build` - Build all packages
- `pnpm test` - Run tests
- `pnpm test:coverage` - Run tests with coverage
- `pnpm test:ui` - Run tests with UI
- `pnpm lint` - Run linting
- `pnpm format` - Format code with Prettier
- `pnpm check-types` - Type checking

### Making Changes

1. Create a new branch for your feature or fix:
   ```bash
   git checkout -b feature/your-feature-name
   ```

2. Make your changes and ensure:
   - All tests pass (`pnpm test`)
   - Code is properly formatted (`pnpm format`)
   - Type checking passes (`pnpm check-types`)
   - Linting passes (`pnpm lint`)

3. Write or update tests for your changes

4. Create a changeset for your changes:
   ```bash
   pnpm changeset
   ```
   - Select the package(s) affected
   - Choose the appropriate version bump (patch/minor/major)
   - Write a concise description of the changes

## Commit Guidelines

We follow conventional commits for clear commit history:

- `feat:` New features
- `fix:` Bug fixes
- `docs:` Documentation changes
- `style:` Code style changes (formatting, etc)
- `refactor:` Code changes that neither fix bugs nor add features
- `test:` Adding or updating tests
- `chore:` Maintenance tasks

Examples:
```
feat: add support for custom code block themes
fix: resolve markdown parsing issue with nested lists
docs: update README with new API examples
```

## Pull Request Process

1. Ensure your PR:
   - Has a clear, descriptive title
   - Includes a changeset (run `pnpm changeset` if you haven't)
   - Passes all CI checks
   - Includes tests for new functionality
   - Updates documentation if needed

2. PR Description should include:
   - What changes were made
   - Why these changes were necessary
   - Any breaking changes
   - Screenshots/demos for UI changes

3. Link any related issues using keywords like `Fixes #123` or `Closes #456`

## Testing

### Running Tests

```bash
# Run all tests
pnpm test

# Run tests with coverage
pnpm test:coverage

# Run tests with UI
pnpm test:ui

# Run tests in watch mode (in package directory)
cd packages/streamdown
pnpm vitest
```

### Writing Tests

- Tests are located in `packages/streamdown/__tests__/`
- Use descriptive test names
- Test both success and error cases
- Ensure good coverage for new features

## Release Process

Releases are automated through GitHub Actions and changesets:

1. When PRs with changesets are merged to `main`, a "Version Packages" PR is automatically created
2. This PR updates package versions and changelogs
3. When the Version Packages PR is merged, packages are automatically published to npm

## Code Style

- We use TypeScript for type safety
- Follow the existing code style in the project
- Use meaningful variable and function names
- Add comments for complex logic
- Keep functions small and focused

## Getting Help

- Open an issue for bugs or feature requests
- Join discussions in GitHub Discussions
- Check existing issues before creating new ones

## License

By contributing to Streamdown, you agree that your contributions will be licensed under the Apache-2.0 License.
`````

## File: LICENSE
`````
Copyright 2023 Vercel, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
`````

## File: package.json
`````json
{
  "name": "streamdown-monorepo",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "test:coverage": "turbo run test:coverage",
    "test:ui": "turbo run test:ui",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "check-types": "turbo run check-types",
    "changeset": "changeset",
    "changeset:version": "changeset version",
    "changeset:publish": "pnpm build && changeset publish"
  },
  "devDependencies": {
    "@biomejs/biome": "2.2.0",
    "@changesets/cli": "^2.27.1",
    "turbo": "^2.5.5",
    "typescript": "5.9.2",
    "ultracite": "5.1.6"
  },
  "packageManager": "pnpm@9.0.0",
  "engines": {
    "node": ">=18"
  }
}
`````

## File: pnpm-workspace.yaml
`````yaml
packages:
  - "apps/*"
  - "packages/*"
`````

## File: README.md
`````markdown
packages/streamdown/README.md
`````

## File: tsconfig.json
`````json
{
  "compilerOptions": {
    "strictNullChecks": true
  }
}
`````

## File: turbo.json
`````json
{
  "$schema": "https://turborepo.com/schema.json",
  "ui": "tui",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "inputs": ["$TURBO_DEFAULT$", ".env*"],
      "outputs": [
        "dist/**",
        ".next/**",
        "!.next/cache/**"
      ]
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "check-types": {
      "dependsOn": ["^check-types"]
    },
    "test": {
      "dependsOn": ["^test"]
    },
    "test:coverage": {
      "dependsOn": ["^test:coverage"]
    },
    "test:ui": {
      "dependsOn": ["^test:ui"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
`````

## File: vercel.json
`````json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "git": {
    "deploymentEnabled": {
      "main": false
    }
  }
}
`````
